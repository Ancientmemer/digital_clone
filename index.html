<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hologram Clone â€“ Gesture Control</title>
<style>
  body{margin:0;overflow:hidden;background:#000}
  video{
    position:fixed; inset:0;
    width:100vw;height:100vh;
    object-fit:cover;
    transform:scaleX(-1);
    z-index:-1;
  }
  canvas{position:fixed; inset:0}
</style>
</head>

<body>
<video id="video" autoplay playsinline muted></video>
<canvas id="three"></canvas>

<!-- THREE -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

<script>
/* ================= CAMERA ================= */
const video = document.getElementById("video");
navigator.mediaDevices.getUserMedia({
  video:{width:960,height:540}, audio:false
}).then(s=>{
  video.srcObject=s;
  video.play();
  init();
});

/* ================= THREE ================= */
let scene, cam, renderer;
const COLOR = 0x00f0ff; // ðŸ”¥ CHANGE COLOR HERE

const mat = new THREE.LineBasicMaterial({
  color: COLOR,
  linewidth: 3
});

const bone = ()=>new THREE.Line(
  new THREE.BufferGeometry().setFromPoints([
    new THREE.Vector3(), new THREE.Vector3()
  ]),
  mat
);

const V = p => new THREE.Vector3(
  (1-p.x)*2-1,
  (1-p.y)*2-1,
  0   // flat (reel look)
);

const setBone = (b,a,c)=>b.geometry.setFromPoints([a,c]);

/* ================= CLONES ================= */
const clones = [];

function createSkeleton(offset){
  const g = new THREE.Group();
  g.position.x = offset;
  scene.add(g);

  const s = {
    head:bone(), spine:bone(),
    lUA:bone(), lLA:bone(),
    rUA:bone(), rLA:bone(),
    lUL:bone(), lLL:bone(),
    rUL:bone(), rLL:bone()
  };

  Object.values(s).forEach(b=>g.add(b));
  return {group:g, bones:s};
}

/* ================= INIT ================= */
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.VideoTexture(video);

  cam = new THREE.PerspectiveCamera(45,innerWidth/innerHeight,0.1,10);
  cam.position.z = 3;

  renderer = new THREE.WebGLRenderer({canvas:three,alpha:true});
  renderer.setSize(innerWidth,innerHeight);
  renderer.setPixelRatio(devicePixelRatio);

  clones.push(createSkeleton(0.6)); // initial clone

  startPose();
  animate();
}

/* ================= MEDIAPIPE POSE ================= */
const pose = new Pose({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`
});
pose.setOptions({
  modelComplexity:0,
  smoothLandmarks:true,
  minDetectionConfidence:0.6,
  minTrackingConfidence:0.6
});

pose.onResults(r=>{
  if(!r.poseLandmarks) return;
  const lm = r.poseLandmarks;

  const head = V(lm[0]);
  const LS = V(lm[11]), RS = V(lm[12]);
  const LW = V(lm[15]), RW = V(lm[16]);
  const LH = V(lm[23]), RH = V(lm[24]);
  const LA = V(lm[27]), RA = V(lm[28]);

  const shoulderMid = LS.clone().add(RS).multiplyScalar(0.5);
  const hipMid = LH.clone().add(RH).multiplyScalar(0.5);

  clones.forEach((c,i)=>{
    const off = 0.6 + i*0.6;

    const SM = shoulderMid.clone(); SM.x += off;
    const HM = hipMid.clone(); HM.x += off;
    const H  = head.clone(); H.x += off;

    const lS=LS.clone();lS.x+=off; const rS=RS.clone();rS.x+=off;
    const lW=LW.clone();lW.x+=off; const rW=RW.clone();rW.x+=off;
    const lH=LH.clone();lH.x+=off; const rH=RH.clone();rH.x+=off;
    const lA=LA.clone();lA.x+=off; const rA=RA.clone();rA.x+=off;

    setBone(c.bones.head, SM, H);
    setBone(c.bones.spine, SM, HM);

    setBone(c.bones.lUA, SM, lS);
    setBone(c.bones.lLA, lS, lW);
    setBone(c.bones.rUA, SM, rS);
    setBone(c.bones.rLA, rS, rW);

    setBone(c.bones.lUL, HM, lH);
    setBone(c.bones.lLL, lH, lA);
    setBone(c.bones.rUL, HM, rH);
    setBone(c.bones.rLL, rH, rA);
  });
});

/* ================= MEDIAPIPE HANDS ================= */
const hands = new Hands({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({
  maxNumHands:1,
  modelComplexity:0,
  minDetectionConfidence:0.6,
  minTrackingConfidence:0.6
});

let palmTimer=0, fistTimer=0;
const HOLD = 5000; // 5 seconds

hands.onResults(r=>{
  if(!r.multiHandLandmarks){
    palmTimer=0; fistTimer=0; return;
  }

  const h = r.multiHandLandmarks[0];
  const wrist = h[0];
  const index = h[8];
  const middle = h[12];

  const isPalm = index.y < wrist.y && middle.y < wrist.y;
  const isFist = index.y > wrist.y && middle.y > wrist.y;

  if(isPalm){
    palmTimer+=16; fistTimer=0;
    if(palmTimer>HOLD){
      palmTimer=0;
      clones.push(createSkeleton(0));
      console.log("+1 clone");
    }
  }
  else if(isFist){
    fistTimer+=16; palmTimer=0;
    if(fistTimer>HOLD){
      fistTimer=0;
      if(clones.length>1){
        const c=clones.pop();
        scene.remove(c.group);
        console.log("-1 clone");
      }
    }
  }
  else{
    palmTimer=0; fistTimer=0;
  }
});

/* ================= LOOPS ================= */
async function startPose(){
  async function loop(){
    await pose.send({image:video});
    await hands.send({image:video});
    requestAnimationFrame(loop);
  }
  loop();
}

function animate(){
  renderer.render(scene,cam);
  requestAnimationFrame(animate);
}

addEventListener("resize",()=>{
  cam.aspect=innerWidth/innerHeight;
  cam.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
